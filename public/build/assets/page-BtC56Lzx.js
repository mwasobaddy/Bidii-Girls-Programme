import{r as o,j as e}from"./app-1-J-Rkvr.js";import{P as G,a as ie,B as v,L as m,I as f}from"./label-BV62W-PP.js";import{C as ne,a as le}from"./card-BY_Q-Zm1.js";import{i as oe,D as L,g as ce,a as B,b as V,c as U}from"./Footer-D5nGiAW4.js";import{T as de}from"./textarea-Dah2xFhi.js";import{u as ue}from"./use-toast-BCIsxhQE.js";import{P as me,S as xe,D as he}from"./delete-confirmation-CNbCtFkH.js";import{I as pe,E as ge,T as fe}from"./image-uploader-B8Gleyuh.js";import{D as je}from"./database-error-D1QB9TqC.js";import{S as ve,a as be,b as Ne,c as ye,d as D}from"./select-D3TONI0m.js";import{A as we}from"./AdminLayout-nImAOwRT.js";import"./index-B_wQ5iga.js";import"./circle-alert-CTpRWOly.js";var k="Progress",A=100,[Pe,Je]=oe(k),[Se,Ce]=Pe(k),J=o.forwardRef((t,i)=>{const{__scopeProgress:g,value:c=null,max:n,getValueLabel:w=De,..._}=t;(n||n===0)&&!M(n)&&console.error(Ee(`${n}`,"Progress"));const d=M(n)?n:A;c!==null&&!z(c,d)&&console.error(_e(`${c}`,"Progress"));const x=z(c,d)?c:null,P=E(x)?w(x,d):void 0;return e.jsx(Se,{scope:g,value:x,max:d,children:e.jsx(G.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":E(x)?x:void 0,"aria-valuetext":P,role:"progressbar","data-state":H(x,d),"data-value":x??void 0,"data-max":d,..._,ref:i})})});J.displayName=k;var W="ProgressIndicator",X=o.forwardRef((t,i)=>{const{__scopeProgress:g,...c}=t,n=Ce(W,g);return e.jsx(G.div,{"data-state":H(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...c,ref:i})});X.displayName=W;function De(t,i){return`${Math.round(t/i*100)}%`}function H(t,i){return t==null?"indeterminate":t===i?"complete":"loading"}function E(t){return typeof t=="number"}function M(t){return E(t)&&!isNaN(t)&&t>0}function z(t,i){return E(t)&&!isNaN(t)&&t<=i&&t>=0}function Ee(t,i){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${i}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${A}\`.`}function _e(t,i){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${i}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${A} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var K=J,Ie=X;const Q=o.forwardRef(({className:t,value:i,...g},c)=>e.jsx(K,{ref:c,className:ie("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...g,children:e.jsx(Ie,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(i||0)}%)`}})}));Q.displayName=K.displayName;const y="http://localhost:8000/api",$e=y.replace("/api",""),q=t=>t?t.startsWith("data:")||t.startsWith("http")?t:`${$e}${t}`:"/placeholder.svg";function Fe(){const[t,i]=o.useState([]),[g,c]=o.useState(!0),[n,w]=o.useState(null),[_,d]=o.useState(!1),[x,P]=o.useState(!1),[Y,I]=o.useState(!1),[j,O]=o.useState(null),[l,Z]=o.useState(null),[R,$]=o.useState(null),[a,b]=o.useState({title:"",description:"",location:"",status:"active",progress:"0",budget:"0",raised:"0",beneficiaries:"0",start_date:"",featured_image:""}),{toast:N}=ue(),F=async()=>{c(!0),w(null);try{const s=await fetch(`${y}/projects`);if(!s.ok)throw new Error("Failed to fetch projects");const r=await s.json();i(r)}catch(s){console.error("Error fetching projects:",s),w("Failed to fetch projects from database")}finally{c(!1)}};o.useEffect(()=>{F()},[]);const p=s=>{const{name:r,value:u}=s.target;b(h=>({...h,[r]:u}))},ee=(s,r)=>{b(u=>({...u,[s]:r}))},se=s=>{b(r=>({...r,featured_image:s}))},te=async s=>{s.preventDefault();try{if(!a.title||!a.description){N({title:"Missing Required Fields",description:"Title and Description are required for a project.",variant:"destructive"});return}const r={title:a.title,description:a.description,location:a.location||null,status:a.status,progress:parseInt(a.progress)||0,budget:parseFloat(a.budget)||0,raised:parseFloat(a.raised)||0,beneficiaries:parseInt(a.beneficiaries)||0,start_date:a.start_date||null,featured_image:a.featured_image||null};console.log("Saving project with data:",r);const u=localStorage.getItem("adminToken");if(!u)throw new Error("No authentication token found. Please log in again.");let h;if(j?h=await fetch(`${y}/projects/${j.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify(r)}):h=await fetch(`${y}/projects`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify(r)}),!h.ok){const C=await h.json();throw new Error(C.message||"Failed to save project")}N({title:j?"Project Updated":"Project Created",description:`"${a.title}" has been ${j?"updated":"created"} successfully.`}),T(),d(!1),F()}catch(r){console.error("Error saving project:",r),N({title:"Error",description:r.message||"Failed to save project",variant:"destructive"})}},T=()=>{b({title:"",description:"",location:"",status:"active",progress:"0",budget:"0",raised:"0",beneficiaries:"0",start_date:"",featured_image:""}),O(null)},ae=s=>{var r,u,h,C;O(s),b({title:s.title||"",description:s.description||"",location:s.location||"",status:s.status||"active",progress:((r=s.progress)==null?void 0:r.toString())||"0",budget:((u=s.budget)==null?void 0:u.toString())||"0",raised:((h=s.raised)==null?void 0:h.toString())||"0",beneficiaries:((C=s.beneficiaries)==null?void 0:C.toString())||"0",start_date:s.start_date||"",featured_image:s.featured_image||""}),d(!0)},re=async()=>{if(R)try{const s=localStorage.getItem("adminToken");if(!s)throw new Error("No authentication token found. Please log in again.");const r=await fetch(`${y}/projects/${R}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(!r.ok){const u=await r.json();throw new Error(u.message||"Failed to delete project")}N({title:"Project Deleted",description:"The project has been deleted successfully."}),F()}catch(s){console.error("Error deleting project:",s),N({title:"Error",description:s.message||"Failed to delete project",variant:"destructive"})}finally{I(!1),$(null)}},S=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return g?e.jsxs("div",{className:"flex items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#e51083]"}),e.jsx("p",{className:"ml-4 text-gray-600 dark:text-gray-400",children:"Loading projects..."})]}):n?e.jsx(je,{message:n}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Projects Management"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Create and manage projects"})]}),e.jsxs(L,{open:_,onOpenChange:d,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(v,{onClick:T,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"New Project"]})}),e.jsxs(B,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(V,{children:e.jsx(U,{children:j?"Edit Project":"Create New Project"})}),e.jsxs("form",{onSubmit:te,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"title",children:"Title *"}),e.jsx(f,{id:"title",name:"title",value:a.title,onChange:p,placeholder:"Enter project title",required:!0})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"location",children:"Location"}),e.jsx(f,{id:"location",name:"location",value:a.location,onChange:p,placeholder:"Project location"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"status",children:"Status"}),e.jsxs(ve,{value:a.status,onValueChange:s=>ee("status",s),children:[e.jsx(be,{children:e.jsx(Ne,{placeholder:"Select status"})}),e.jsxs(ye,{children:[e.jsx(D,{value:"active",children:"Active"}),e.jsx(D,{value:"completed",children:"Completed"}),e.jsx(D,{value:"planned",children:"Planned"}),e.jsx(D,{value:"paused",children:"Paused"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"progress",children:"Progress (%)"}),e.jsx(f,{id:"progress",name:"progress",type:"number",min:"0",max:"100",value:a.progress,onChange:p,placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"start_date",children:"Start Date"}),e.jsx(f,{id:"start_date",name:"start_date",type:"date",value:a.start_date,onChange:p})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"budget",children:"Budget ($)"}),e.jsx(f,{id:"budget",name:"budget",type:"number",min:"0",step:"0.01",value:a.budget,onChange:p,placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"raised",children:"Amount Raised ($)"}),e.jsx(f,{id:"raised",name:"raised",type:"number",min:"0",step:"0.01",value:a.raised,onChange:p,placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"beneficiaries",children:"Beneficiaries"}),e.jsx(f,{id:"beneficiaries",name:"beneficiaries",type:"number",min:"0",value:a.beneficiaries,onChange:p,placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Featured Image"}),e.jsx(pe,{currentImage:a.featured_image,onImageSelected:se,aspectRatio:"16:9"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",children:"Description *"}),e.jsx(de,{id:"description",name:"description",value:a.description,onChange:p,placeholder:"Project description",rows:5,required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>{T(),d(!1)},children:"Cancel"}),e.jsx(v,{type:"submit",children:j?"Update Project":"Create Project"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(s=>e.jsxs(ne,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-video bg-gray-100 relative",children:s.featured_image?e.jsx("img",{src:q(s.featured_image),alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"No Image"})}),e.jsxs(le,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-2",children:s.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[s.progress,"%"]})]}),e.jsx(Q,{value:s.progress,className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Raised: ",S(s.raised)]}),e.jsxs("span",{children:["Goal: ",S(s.budget)]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="active"?"bg-green-100 text-green-800":s.status==="completed"?"bg-blue-100 text-blue-800":s.status==="planned"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:s.status}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.beneficiaries," beneficiaries"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{size:"sm",variant:"outline",onClick:()=>{Z(s),P(!0)},children:e.jsx(ge,{className:"h-3 w-3"})}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>ae(s),children:e.jsx(xe,{className:"h-3 w-3"})}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>{$(s.id),I(!0)},children:e.jsx(fe,{className:"h-3 w-3"})})]})]})]},s.id))}),e.jsx(L,{open:x,onOpenChange:P,children:e.jsxs(B,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(V,{children:e.jsx(U,{children:l==null?void 0:l.title})}),l&&e.jsxs("div",{className:"space-y-4",children:[l.featured_image&&e.jsx("img",{src:q(l.featured_image),alt:l.title,className:"w-full rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Location"}),e.jsx("p",{className:"font-medium",children:l.location||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Status"}),e.jsx("p",{className:"font-medium capitalize",children:l.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Budget"}),e.jsx("p",{className:"font-medium",children:S(l.budget)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Raised"}),e.jsx("p",{className:"font-medium",children:S(l.raised)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Progress"}),e.jsxs("p",{className:"font-medium",children:[l.progress,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Beneficiaries"}),e.jsx("p",{className:"font-medium",children:l.beneficiaries})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Description"}),e.jsx("p",{className:"whitespace-pre-wrap",children:l.description})]})]})]})}),e.jsx(he,{isOpen:Y,onClose:()=>{I(!1),$(null)},onConfirm:re,itemName:"project"})]})}Fe.layout=t=>e.jsx(we,{children:t});export{Fe as default};
