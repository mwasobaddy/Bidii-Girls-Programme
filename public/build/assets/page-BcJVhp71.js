import{r as i,j as e}from"./app-1-J-Rkvr.js";import{c as W,B as p,L as l,I as g}from"./label-BV62W-PP.js";import{C as H,a as J}from"./card-BY_Q-Zm1.js";import{D as k,g as K,a as F,b as I,c as T}from"./Footer-D5nGiAW4.js";import{T as G}from"./textarea-Dah2xFhi.js";import{u as Q}from"./use-toast-BCIsxhQE.js";import{P as X,S as Y,D as Z}from"./delete-confirmation-CNbCtFkH.js";import{I as ee,E as se,T as te}from"./image-uploader-B8Gleyuh.js";import{D as ae}from"./database-error-D1QB9TqC.js";import{A as ne}from"./AdminLayout-nImAOwRT.js";import"./index-B_wQ5iga.js";import"./circle-alert-CTpRWOly.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],re=W("external-link",ie),u="http://localhost:8000/api",oe=u.replace("/api",""),$=r=>r?r.startsWith("data:")||r.startsWith("http")?r:`${oe}${r}`:"/placeholder.svg";function le(){const[r,L]=i.useState([]),[O,N]=i.useState(!0),[w,S]=i.useState(null),[A,x]=i.useState(!1),[U,_]=i.useState(!1),[z,f]=i.useState(!1),[c,C]=i.useState(null),[a,q]=i.useState(null),[D,y]=i.useState(null),[n,j]=i.useState({name:"",description:"",website:"",contact_email:"",logo:"",contribution_amount:"",partnership_type:"financial"}),{toast:h}=Q(),b=async()=>{N(!0),S(null);try{const s=await fetch(`${u}/sponsors`);if(!s.ok)throw new Error("Failed to fetch sponsors");const t=await s.json();L(t)}catch(s){console.error("Error fetching sponsors:",s),S("Failed to fetch sponsors from database")}finally{N(!1)}};i.useEffect(()=>{b()},[]);const d=s=>{const{name:t,value:o}=s.target;j(m=>({...m,[t]:o}))},B=s=>{j(t=>({...t,logo:s}))},P=async s=>{s.preventDefault();try{if(!n.name){h({title:"Missing Required Fields",description:"Name is required for a sponsor.",variant:"destructive"});return}const t={name:n.name,description:n.description||null,website:n.website||null,contact_email:n.contact_email||null,logo:n.logo||null,contribution_amount:parseFloat(n.contribution_amount)||0,partnership_type:n.partnership_type,active:!0};console.log("Saving sponsor with data:",t);const o=localStorage.getItem("adminToken");if(!o)throw new Error("No authentication token found. Please log in again.");let m;if(c?m=await fetch(`${u}/sponsors/${c.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(t)}):m=await fetch(`${u}/sponsors`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(t)}),!m.ok){const V=await m.json();throw new Error(V.message||"Failed to save sponsor")}h({title:c?"Sponsor Updated":"Sponsor Created",description:`"${n.name}" has been ${c?"updated":"created"} successfully.`}),v(),x(!1),b()}catch(t){console.error("Error saving sponsor:",t),h({title:"Error",description:t.message||"Failed to save sponsor",variant:"destructive"})}},v=()=>{j({name:"",description:"",website:"",contact_email:"",logo:"",contribution_amount:"",partnership_type:"financial"}),C(null)},M=s=>{var t;C(s),j({name:s.name||"",description:s.description||"",website:s.website||"",contact_email:s.contact_email||"",logo:s.logo||"",contribution_amount:((t=s.contribution_amount)==null?void 0:t.toString())||"",partnership_type:s.partnership_type||"financial"}),x(!0)},R=async()=>{if(D)try{const s=localStorage.getItem("adminToken");if(!s)throw new Error("No authentication token found. Please log in again.");const t=await fetch(`${u}/sponsors/${D}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(!t.ok){const o=await t.json();throw new Error(o.message||"Failed to delete sponsor")}h({title:"Sponsor Deleted",description:"The sponsor has been deleted successfully."}),b()}catch(s){console.error("Error deleting sponsor:",s),h({title:"Error",description:s.message||"Failed to delete sponsor",variant:"destructive"})}finally{f(!1),y(null)}},E=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return O?e.jsxs("div",{className:"flex items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#e51083]"}),e.jsx("p",{className:"ml-4 text-gray-600 dark:text-gray-400",children:"Loading sponsors..."})]}):w?e.jsx(ae,{message:w}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Sponsors Management"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Manage sponsors and partnerships"})]}),e.jsxs(k,{open:A,onOpenChange:x,children:[e.jsx(K,{asChild:!0,children:e.jsxs(p,{onClick:v,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"New Sponsor"]})}),e.jsxs(F,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(I,{children:e.jsx(T,{children:c?"Edit Sponsor":"Add New Sponsor"})}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",children:"Name *"}),e.jsx(g,{id:"name",name:"name",value:n.name,onChange:d,placeholder:"Enter sponsor name",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"website",children:"Website"}),e.jsx(g,{id:"website",name:"website",type:"url",value:n.website,onChange:d,placeholder:"https://example.com"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"contact_email",children:"Contact Email"}),e.jsx(g,{id:"contact_email",name:"contact_email",type:"email",value:n.contact_email,onChange:d,placeholder:"contact@sponsor.com"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"contribution_amount",children:"Contribution Amount ($)"}),e.jsx(g,{id:"contribution_amount",name:"contribution_amount",type:"number",min:"0",step:"0.01",value:n.contribution_amount,onChange:d,placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"partnership_type",children:"Partnership Type"}),e.jsxs("select",{id:"partnership_type",name:"partnership_type",value:n.partnership_type,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"financial",children:"Financial"}),e.jsx("option",{value:"in-kind",children:"In-Kind"}),e.jsx("option",{value:"service",children:"Service"}),e.jsx("option",{value:"strategic",children:"Strategic"})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(l,{children:"Logo"}),e.jsx(ee,{currentImage:n.logo,onImageSelected:B,aspectRatio:"16:9"})]})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",children:"Description"}),e.jsx(G,{id:"description",name:"description",value:n.description,onChange:d,placeholder:"Sponsor description",rows:4})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>{v(),x(!1)},children:"Cancel"}),e.jsx(p,{type:"submit",children:c?"Update Sponsor":"Add Sponsor"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(s=>e.jsxs(H,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-video bg-gray-100 relative",children:s.logo?e.jsx("img",{src:$(s.logo),alt:s.name,className:"w-full h-full object-contain p-4"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"No Logo"})}),e.jsxs(J,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Partnership:"}),e.jsx("span",{className:"capitalize font-medium",children:s.partnership_type})]}),s.contribution_amount>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Contribution:"}),e.jsx("span",{className:"font-medium",children:E(s.contribution_amount)})]}),s.website&&e.jsxs("div",{className:"flex items-center space-x-1 text-sm",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline truncate",children:s.website.replace(/^https?:\/\//,"")})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(p,{size:"sm",variant:"outline",onClick:()=>{q(s),_(!0)},children:e.jsx(se,{className:"h-3 w-3"})}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>M(s),children:e.jsx(Y,{className:"h-3 w-3"})}),e.jsx(p,{size:"sm",variant:"outline",onClick:()=>{y(s.id),f(!0)},children:e.jsx(te,{className:"h-3 w-3"})})]})]})]},s.id))}),e.jsx(k,{open:U,onOpenChange:_,children:e.jsxs(F,{className:"max-w-2xl",children:[e.jsx(I,{children:e.jsx(T,{children:a==null?void 0:a.name})}),a&&e.jsxs("div",{className:"space-y-4",children:[a.logo&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:$(a.logo),alt:a.name,className:"max-w-full max-h-32 object-contain"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Partnership Type"}),e.jsx("p",{className:"font-medium capitalize",children:a.partnership_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contribution"}),e.jsx("p",{className:"font-medium",children:E(a.contribution_amount)})]}),a.contact_email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contact Email"}),e.jsx("p",{className:"font-medium",children:a.contact_email})]}),a.website&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Website"}),e.jsx("a",{href:a.website,target:"_blank",rel:"noopener noreferrer",className:"font-medium text-blue-600 hover:underline",children:a.website})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Description"}),e.jsx("p",{className:"whitespace-pre-wrap",children:a.description})]})]})]})}),e.jsx(Z,{isOpen:z,onClose:()=>{f(!1),y(null)},onConfirm:R,itemName:"sponsor"})]})}le.layout=r=>e.jsx(ne,{children:r});export{le as default};
