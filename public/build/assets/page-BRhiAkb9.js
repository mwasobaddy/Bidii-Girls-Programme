import{r as i,j as e}from"./app-1-J-Rkvr.js";import{B as h,L as l,I as p}from"./label-BV62W-PP.js";import{C as H,a as K}from"./card-BY_Q-Zm1.js";import{D as E,g as G,a as I,b as T,c as F}from"./Footer-D5nGiAW4.js";import{T as k}from"./textarea-Dah2xFhi.js";import{u as Q}from"./use-toast-BCIsxhQE.js";import{P as X,S as Y,D as Z}from"./delete-confirmation-CNbCtFkH.js";import{I as ee,E as te,T as ae}from"./image-uploader-B8Gleyuh.js";import{D as se}from"./database-error-D1QB9TqC.js";import{A as re}from"./AdminLayout-nImAOwRT.js";import{U as O}from"./user-CuY1X4ky.js";import{C as $}from"./calendar-9IpFjb3C.js";import"./index-B_wQ5iga.js";import"./circle-alert-CTpRWOly.js";const x="http://localhost:8000/api",ie=x.replace("/api",""),L=n=>n?n.startsWith("data:")||n.startsWith("http")?n:`${ie}${n}`:"/placeholder.svg";function ne(){const[n,A]=i.useState([]),[B,N]=i.useState(!0),[S,_]=i.useState(null),[U,f]=i.useState(!1),[z,w]=i.useState(!1),[q,j]=i.useState(!1),[d,D]=i.useState(null),[s,P]=i.useState(null),[C,y]=i.useState(null),[a,g]=i.useState({title:"",content:"",author:"",location:"",date_published:new Date().toISOString().split("T")[0],featured_image:"",impact_summary:"",beneficiary_name:""}),{toast:u}=Q(),b=async()=>{N(!0),_(null);try{const t=await fetch(`${x}/stories`);if(!t.ok)throw new Error("Failed to fetch stories");const r=await t.json();A(r)}catch(t){console.error("Error fetching stories:",t),_("Failed to fetch stories from database")}finally{N(!1)}};i.useEffect(()=>{b()},[]);const o=t=>{const{name:r,value:c}=t.target;g(m=>({...m,[r]:c}))},R=t=>{g(r=>({...r,featured_image:t}))},V=async t=>{t.preventDefault();try{if(!a.title||!a.content){u({title:"Missing Required Fields",description:"Title and Content are required for a story.",variant:"destructive"});return}const r={title:a.title,content:a.content,author:a.author||"Anonymous",location:a.location||null,date_published:a.date_published||null,featured_image:a.featured_image||null,impact_summary:a.impact_summary||null,beneficiary_name:a.beneficiary_name||null,published:!0};console.log("Saving story with data:",r);const c=localStorage.getItem("adminToken");if(!c)throw new Error("No authentication token found. Please log in again.");let m;if(d?m=await fetch(`${x}/stories/${d.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(r)}):m=await fetch(`${x}/stories`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(r)}),!m.ok){const M=await m.json();throw new Error(M.message||"Failed to save story")}u({title:d?"Story Updated":"Story Created",description:`"${a.title}" has been ${d?"updated":"created"} successfully.`}),v(),f(!1),b()}catch(r){console.error("Error saving story:",r),u({title:"Error",description:r.message||"Failed to save story",variant:"destructive"})}},v=()=>{g({title:"",content:"",author:"",location:"",date_published:new Date().toISOString().split("T")[0],featured_image:"",impact_summary:"",beneficiary_name:""}),D(null)},W=t=>{D(t),g({title:t.title||"",content:t.content||"",author:t.author||"",location:t.location||"",date_published:t.date_published||new Date().toISOString().split("T")[0],featured_image:t.featured_image||"",impact_summary:t.impact_summary||"",beneficiary_name:t.beneficiary_name||""}),f(!0)},J=async()=>{if(C)try{const t=localStorage.getItem("adminToken");if(!t)throw new Error("No authentication token found. Please log in again.");const r=await fetch(`${x}/stories/${C}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const c=await r.json();throw new Error(c.message||"Failed to delete story")}u({title:"Story Deleted",description:"The story has been deleted successfully."}),b()}catch(t){console.error("Error deleting story:",t),u({title:"Error",description:t.message||"Failed to delete story",variant:"destructive"})}finally{j(!1),y(null)}};return B?e.jsxs("div",{className:"flex items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#e51083]"}),e.jsx("p",{className:"ml-4 text-gray-600 dark:text-gray-400",children:"Loading stories..."})]}):S?e.jsx(se,{message:S}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Stories Management"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Share inspiring stories and testimonials"})]}),e.jsxs(E,{open:U,onOpenChange:f,children:[e.jsx(G,{asChild:!0,children:e.jsxs(h,{onClick:v,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"New Story"]})}),e.jsxs(I,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(F,{children:d?"Edit Story":"Create New Story"})}),e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"title",children:"Title *"}),e.jsx(p,{id:"title",name:"title",value:a.title,onChange:o,placeholder:"Enter story title",required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"author",children:"Author"}),e.jsx(p,{id:"author",name:"author",value:a.author,onChange:o,placeholder:"Story author"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"beneficiary_name",children:"Beneficiary Name"}),e.jsx(p,{id:"beneficiary_name",name:"beneficiary_name",value:a.beneficiary_name,onChange:o,placeholder:"Name of the person featured in the story"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"location",children:"Location"}),e.jsx(p,{id:"location",name:"location",value:a.location,onChange:o,placeholder:"Story location"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"date_published",children:"Published Date"}),e.jsx(p,{id:"date_published",name:"date_published",type:"date",value:a.date_published,onChange:o})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(l,{children:"Featured Image"}),e.jsx(ee,{currentImage:a.featured_image,onImageSelected:R,aspectRatio:"16:9"})]})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"impact_summary",children:"Impact Summary"}),e.jsx(k,{id:"impact_summary",name:"impact_summary",value:a.impact_summary,onChange:o,placeholder:"Brief summary of the impact or outcome",rows:3})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"content",children:"Story Content *"}),e.jsx(k,{id:"content",name:"content",value:a.content,onChange:o,placeholder:"Write the full story here...",rows:10,required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>{v(),f(!1)},children:"Cancel"}),e.jsx(h,{type:"submit",children:d?"Update Story":"Create Story"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(t=>e.jsxs(H,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-video bg-gray-100 relative",children:t.featured_image?e.jsx("img",{src:L(t.featured_image),alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"No Image"})}),e.jsxs(K,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-2",children:t.title}),t.impact_summary&&e.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:t.impact_summary}),t.beneficiary_name&&e.jsxs("p",{className:"text-sm font-medium text-blue-600 mb-2",children:["Story of ",t.beneficiary_name]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-4",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),t.author,e.jsx($,{className:"h-3 w-3 ml-3 mr-1"}),new Date(t.date_published).toLocaleDateString()]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{size:"sm",variant:"outline",onClick:()=>{P(t),w(!0)},children:e.jsx(te,{className:"h-3 w-3"})}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>W(t),children:e.jsx(Y,{className:"h-3 w-3"})}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>{y(t.id),j(!0)},children:e.jsx(ae,{className:"h-3 w-3"})})]})]})]},t.id))}),e.jsx(E,{open:z,onOpenChange:w,children:e.jsxs(I,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(F,{children:s==null?void 0:s.title})}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),s.author,e.jsx($,{className:"h-4 w-4 ml-4 mr-1"}),new Date(s.date_published).toLocaleDateString()]}),s.featured_image&&e.jsx("img",{src:L(s.featured_image),alt:s.title,className:"w-full rounded-lg"}),s.beneficiary_name&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-600 font-medium",children:["Story of ",s.beneficiary_name]}),s.location&&e.jsxs("p",{className:"text-sm text-blue-500",children:["Location: ",s.location]})]}),s.impact_summary&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-700 mb-2",children:"Impact Summary"}),e.jsx("p",{className:"text-green-600",children:s.impact_summary})]}),e.jsx("div",{className:"prose max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap",children:s.content})})]})]})}),e.jsx(Z,{isOpen:q,onClose:()=>{j(!1),y(null)},onConfirm:J,itemName:"story"})]})}ne.layout=n=>e.jsx(re,{children:n});export{ne as default};
