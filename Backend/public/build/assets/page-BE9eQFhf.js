import{r as l,j as e}from"./app-1-J-Rkvr.js";import{B as u,L as c,I as x}from"./label-BV62W-PP.js";import{C as re,a as oe}from"./card-BY_Q-Zm1.js";import{D as k,g as le,a as A,b as $,c as L}from"./Footer-D5nGiAW4.js";import{T as U}from"./textarea-Dah2xFhi.js";import{u as ne}from"./use-toast-BCIsxhQE.js";import{S as ie,a as ce,b as de,c as he,d as _}from"./select-D3TONI0m.js";import{P as me,S as ge,D as ue}from"./delete-confirmation-CNbCtFkH.js";import{I as q,E as xe,T as pe}from"./image-uploader-B8Gleyuh.js";import{D as fe}from"./database-error-D1QB9TqC.js";import{A as je}from"./AdminLayout-nImAOwRT.js";import{U as z}from"./user-CuY1X4ky.js";import{C as R}from"./calendar-9IpFjb3C.js";import"./index-B_wQ5iga.js";import"./circle-alert-CTpRWOly.js";const p="http://localhost:8000/api",ye=p.replace("/api",""),M=n=>n?n.startsWith("data:")||n.startsWith("http")?n:`${ye}${n}`:"/placeholder.svg";function ve(){const[n,V]=l.useState([]),[H,W]=l.useState([]),[J,E]=l.useState(!0),[I,T]=l.useState(null),[K,f]=l.useState(!1),[G,P]=l.useState(!1),[Q,b]=l.useState(!1),[d,F]=l.useState(null),[i,X]=l.useState(null),[B,C]=l.useState(null),[a,h]=l.useState({title:"",content:"",author:"",author_image:"",published_date:new Date().toISOString().split("T")[0],featured_image:"",category:"none",tags:"",excerpt:""}),[j,O]=l.useState(""),{toast:m}=ne(),w=async()=>{E(!0),T(null);try{const t=await fetch(`${p}/blog`);if(!t.ok)throw new Error("Failed to fetch blog posts");const s=await t.json();V(s);const r=Array.from(new Set(s.map(o=>o.category).filter(o=>typeof o=="string"&&o!==null&&o!==void 0&&o.trim()!==""))).sort();W(r)}catch(t){console.error("Error fetching blog posts:",t),T("Failed to fetch blog posts from database")}finally{E(!1)}};l.useEffect(()=>{w()},[]);const g=t=>{const{name:s,value:r}=t.target;h(o=>({...o,[s]:r}))},Y=(t,s)=>{h(r=>({...r,[t]:s}))},Z=t=>{h(s=>({...s,featured_image:t}))},ee=t=>{h(s=>({...s,author_image:t}))},te=async t=>{var s;t.preventDefault();try{if(!a.title||!a.content){m({title:"Missing Required Fields",description:"Title and Content are required for a blog post.",variant:"destructive"});return}if(a.category==="other"&&!j.trim()){m({title:"Missing Custom Category",description:"Please enter a custom category name when 'Other' is selected.",variant:"destructive"});return}let r=a.excerpt;if(!r&&a.content){const v=document.createElement("div");v.innerHTML=a.content,r=((s=v.textContent)==null?void 0:s.slice(0,150))+"..."||""}let o=a.category;a.category==="other"&&j.trim()?o=j.trim():a.category==="none"&&(o=null);const S={title:a.title,content:a.content,author:a.author||"Anonymous",author_image:a.author_image||null,published_date:a.published_date||null,featured_image:a.featured_image||null,category:o==="other"?null:o,tags:a.tags||null,excerpt:r,published:!0};console.log("Saving blog post with data:",S);const D=localStorage.getItem("adminToken");if(!D)throw new Error("No authentication token found. Please log in again.");let y;if(d?y=await fetch(`${p}/blog/${d.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${D}`},body:JSON.stringify(S)}):y=await fetch(`${p}/blog`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${D}`},body:JSON.stringify(S)}),!y.ok){const v=await y.json();throw new Error(v.message||"Failed to save blog post")}m({title:d?"Blog Post Updated":"Blog Post Created",description:`"${a.title}" has been ${d?"updated":"created"} successfully.`}),N(),f(!1),w()}catch(r){console.error("Error saving blog post:",r),m({title:"Error",description:r.message||"Failed to save blog post",variant:"destructive"})}},N=()=>{h({title:"",content:"",author:"",author_image:"",published_date:new Date().toISOString().split("T")[0],featured_image:"",category:"none",tags:"",excerpt:""}),O(""),F(null)},ae=t=>{F(t),h({title:t.title||"",content:t.content||"",author:t.author||"",author_image:t.author_image||"",published_date:t.published_date||new Date().toISOString().split("T")[0],featured_image:t.featured_image||"",category:t.category||"none",tags:t.tags||"",excerpt:t.excerpt||""}),f(!0)},se=async()=>{if(B)try{const t=localStorage.getItem("adminToken");if(!t)throw new Error("No authentication token found. Please log in again.");const s=await fetch(`${p}/blog/${B}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!s.ok){const r=await s.json();throw new Error(r.message||"Failed to delete blog post")}m({title:"Blog Post Deleted",description:"The blog post has been deleted successfully."}),w()}catch(t){console.error("Error deleting blog post:",t),m({title:"Error",description:t.message||"Failed to delete blog post",variant:"destructive"})}finally{b(!1),C(null)}};return J?e.jsxs("div",{className:"flex items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#e51083]"}),e.jsx("p",{className:"ml-4 text-gray-600 dark:text-gray-400",children:"Loading blog posts..."})]}):I?e.jsx(fe,{message:I}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Blog Management"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Create and manage blog posts"})]}),e.jsxs(k,{open:K,onOpenChange:f,children:[e.jsx(le,{asChild:!0,children:e.jsxs(u,{onClick:N,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"New Blog Post"]})}),e.jsxs(A,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx($,{children:e.jsx(L,{children:d?"Edit Blog Post":"Create New Blog Post"})}),e.jsxs("form",{onSubmit:te,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"title",children:"Title *"}),e.jsx(x,{id:"title",name:"title",value:a.title,onChange:g,placeholder:"Enter blog post title",required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"author",children:"Author"}),e.jsx(x,{id:"author",name:"author",value:a.author,onChange:g,placeholder:"Author name"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"published_date",children:"Published Date"}),e.jsx(x,{id:"published_date",name:"published_date",type:"date",value:a.published_date,onChange:g})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"category",children:"Category"}),e.jsxs(ie,{value:a.category,onValueChange:t=>Y("category",t),children:[e.jsx(ce,{children:e.jsx(de,{placeholder:"Select a category"})}),e.jsxs(he,{children:[e.jsx(_,{value:"none",children:"No Category"}),H.map(t=>e.jsx(_,{value:t,children:t},t)),e.jsx(_,{value:"other",children:"Other (specify below)"})]})]})]}),a.category==="other"&&e.jsxs("div",{children:[e.jsx(c,{htmlFor:"customCategory",children:"Custom Category"}),e.jsx(x,{id:"customCategory",value:j,onChange:t=>O(t.target.value),placeholder:"Enter custom category"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"tags",children:"Tags"}),e.jsx(x,{id:"tags",name:"tags",value:a.tags,onChange:g,placeholder:"Comma-separated tags"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Featured Image"}),e.jsx(q,{currentImage:a.featured_image,onImageSelected:Z,aspectRatio:"16:9"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Author Image"}),e.jsx(q,{currentImage:a.author_image,onImageSelected:ee,aspectRatio:"1:1"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"excerpt",children:"Excerpt"}),e.jsx(U,{id:"excerpt",name:"excerpt",value:a.excerpt,onChange:g,placeholder:"Brief description of the blog post",rows:3})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"content",children:"Content *"}),e.jsx(U,{id:"content",name:"content",value:a.content,onChange:g,placeholder:"Write your blog post content here...",rows:10,required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>{N(),f(!1)},children:"Cancel"}),e.jsx(u,{type:"submit",children:d?"Update Post":"Create Post"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map(t=>e.jsxs(re,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-video bg-gray-100 relative",children:t.featured_image?e.jsx("img",{src:M(t.featured_image),alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"No Image"})}),e.jsxs(oe,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-2",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:t.excerpt}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-4",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),t.author,e.jsx(R,{className:"h-3 w-3 ml-3 mr-1"}),new Date(t.published_date).toLocaleDateString()]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{size:"sm",variant:"outline",onClick:()=>{X(t),P(!0)},children:e.jsx(xe,{className:"h-3 w-3"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>ae(t),children:e.jsx(ge,{className:"h-3 w-3"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>{C(t.id),b(!0)},children:e.jsx(pe,{className:"h-3 w-3"})})]})]})]},t.id))}),e.jsx(k,{open:G,onOpenChange:P,children:e.jsxs(A,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx($,{children:e.jsx(L,{children:i==null?void 0:i.title})}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),i.author,e.jsx(R,{className:"h-4 w-4 ml-4 mr-1"}),new Date(i.published_date).toLocaleDateString()]}),i.featured_image&&e.jsx("img",{src:M(i.featured_image),alt:i.title,className:"w-full rounded-lg"}),e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:i.content}})]})]})}),e.jsx(ue,{isOpen:Q,onClose:()=>{b(!1),C(null)},onConfirm:se,itemName:"blog post"})]})}ve.layout=n=>e.jsx(je,{children:n});export{ve as default};
