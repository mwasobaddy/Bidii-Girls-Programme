import{r,j as e}from"./app-1-J-Rkvr.js";import{c as Z,B as m,L as h,I as Q}from"./label-BV62W-PP.js";import{C as X,a as Y}from"./card-BY_Q-Zm1.js";import{D as k,g as ee,a as T,b as F,c as _}from"./Footer-D5nGiAW4.js";import{T as ae}from"./textarea-Dah2xFhi.js";import{u as se}from"./use-toast-BCIsxhQE.js";import{S as B,a as L,b as M,c as z,d as v}from"./select-D3TONI0m.js";import{U as te,I as le,E as re,T as ne}from"./image-uploader-B8Gleyuh.js";import{D as ie,I as oe}from"./database-error-D1QB9TqC.js";import{A as ce}from"./AdminLayout-nImAOwRT.js";import"./index-B_wQ5iga.js";import"./circle-alert-CTpRWOly.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],A=Z("folder",de),p="http://localhost:8000/api";function O(n){return n?n.startsWith("http")||n.startsWith("data:")?n:`${p.replace("/api","")}${n}`:"/placeholder.svg"}function me(){var U;const[n,w]=r.useState([]),[g,u]=r.useState([]),[j]=r.useState([{name:"Blog Images",folder:"blog"},{name:"Project Images",folder:"projects"},{name:"Campaign Images",folder:"campaigns"},{name:"Team Images",folder:"team"},{name:"Other Images",folder:"other"}]),[o,$]=r.useState("all"),[V,I]=r.useState(!0),[C,S]=r.useState(null),[R,f]=r.useState(!1),[G,b]=r.useState(!1),[t,K]=r.useState(null),[i,x]=r.useState({image:"",category:"other",alt_text:"",caption:""}),{toast:d}=se(),y=async()=>{I(!0),S(null);try{const a=await fetch(`${p}/gallery-scan`);if(!a.ok)throw new Error("Failed to fetch gallery items");const s=await a.json();w(s),u(s)}catch(a){console.error("Error fetching gallery items:",a),S("Failed to fetch gallery items from server")}finally{I(!1)}};r.useEffect(()=>{y()},[]),r.useEffect(()=>{u(o==="all"?n:n.filter(a=>a.category===o))},[o,n]);const D=a=>{const{name:s,value:l}=a.target;x(c=>({...c,[s]:l}))},P=(a,s)=>{x(l=>({...l,[a]:s}))},H=a=>{x(s=>({...s,image:a}))},W=async a=>{a.preventDefault();try{if(!i.image){d({title:"Missing Image",description:"Please select an image to upload.",variant:"destructive"});return}const s={image:i.image,category:i.category,alt_text:i.alt_text||null,caption:i.caption||null};console.log("Uploading image with data:",s);const l=localStorage.getItem("adminToken");if(!l)throw new Error("No authentication token found. Please log in again.");const c=await fetch(`${p}/gallery`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(s)});if(!c.ok){const J=await c.json();throw new Error(J.message||"Failed to upload image")}d({title:"Image Uploaded",description:"The image has been uploaded successfully."}),N(),f(!1),y()}catch(s){console.error("Error uploading image:",s),d({title:"Error",description:s.message||"Failed to upload image",variant:"destructive"})}},N=()=>{x({image:"",category:"other",alt_text:"",caption:""})},q=async a=>{try{const s=localStorage.getItem("adminToken");if(!s)throw new Error("No authentication token found. Please log in again.");const l=await fetch(`${p}/gallery/${encodeURIComponent(a)}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(!l.ok){const c=await l.json();throw new Error(c.message||"Failed to delete image")}d({title:"Image Deleted",description:"The image has been deleted successfully."}),y()}catch(s){console.error("Error deleting image:",s),d({title:"Error",description:s.message||"Failed to delete image",variant:"destructive"})}},E=a=>{if(!a)return"Unknown size";const s=["Bytes","KB","MB","GB"];if(a===0)return"0 Bytes";const l=Math.floor(Math.log(a)/Math.log(1024));return Math.round(a/Math.pow(1024,l)*100)/100+" "+s[l]};return V?e.jsxs("div",{className:"flex items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#e51083]"}),e.jsx("p",{className:"ml-4 text-gray-600 dark:text-gray-400",children:"Loading gallery..."})]}):C?e.jsx(ie,{message:C}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Gallery Management"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Manage gallery images and uploads"})]}),e.jsxs(k,{open:R,onOpenChange:f,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(m,{onClick:N,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Upload Image"]})}),e.jsxs(T,{className:"max-w-2xl",children:[e.jsx(F,{children:e.jsx(_,{children:"Upload New Image"})}),e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Select Image"}),e.jsx(le,{currentImage:i.image,onImageSelected:H,aspectRatio:"16:9"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"category",children:"Category"}),e.jsxs(B,{value:i.category,onValueChange:a=>P("category",a),children:[e.jsx(L,{children:e.jsx(M,{placeholder:"Select category"})}),e.jsx(z,{children:j.map(a=>e.jsx(v,{value:a.folder,children:a.name},a.folder))})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"alt_text",children:"Alt Text"}),e.jsx(Q,{id:"alt_text",name:"alt_text",value:i.alt_text,onChange:D,placeholder:"Alternative text for accessibility"})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"caption",children:"Caption"}),e.jsx(ae,{id:"caption",name:"caption",value:i.caption,onChange:D,placeholder:"Image caption",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>{N(),f(!1)},children:"Cancel"}),e.jsx(m,{type:"submit",children:"Upload Image"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Filter by category:"}),e.jsxs(B,{value:o,onValueChange:$,children:[e.jsx(L,{className:"w-48",children:e.jsx(M,{})}),e.jsxs(z,{children:[e.jsx(v,{value:"all",children:"All Categories"}),j.map(a=>e.jsx(v,{value:a.folder,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:a.name})]})},a.folder))]})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[g.length," ",g.length===1?"image":"images"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6",children:g.map((a,s)=>e.jsxs(X,{className:"overflow-hidden",children:[e.jsxs("div",{className:"aspect-square bg-gray-100 relative group",children:[e.jsx("img",{src:O(a.url),alt:a.alt_text||a.name,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center space-x-2",children:[e.jsx(m,{size:"sm",variant:"secondary",onClick:()=>{K(a),b(!0)},children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"destructive",onClick:()=>q(a.name),children:e.jsx(ne,{className:"h-4 w-4"})})]})]}),e.jsxs(Y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(A,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 capitalize",children:a.category})]}),e.jsx("p",{className:"font-medium text-sm truncate mb-1",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:E(a.size)})]})]},s))}),g.length===0&&e.jsxs("div",{className:"text-center py-20",children:[e.jsx(oe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No images found"}),e.jsx("p",{className:"text-gray-500",children:o==="all"?"Upload some images to get started":`No images in the ${(U=j.find(a=>a.folder===o))==null?void 0:U.name} category`})]}),e.jsx(k,{open:G,onOpenChange:b,children:e.jsxs(T,{className:"max-w-4xl",children:[e.jsx(F,{children:e.jsx(_,{children:t==null?void 0:t.name})}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:O(t.url),alt:t.alt_text||t.name,className:"max-w-full max-h-96 object-contain rounded-lg"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Category"}),e.jsx("p",{className:"font-medium capitalize",children:t.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"File Size"}),e.jsx("p",{className:"font-medium",children:E(t.size)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"File Name"}),e.jsx("p",{className:"font-medium",children:t.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Last Modified"}),e.jsx("p",{className:"font-medium",children:t.lastModified?new Date(t.lastModified).toLocaleDateString():"Unknown"})]})]}),t.caption&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Caption"}),e.jsx("p",{className:"text-sm",children:t.caption})]})]})]})})]})}me.layout=n=>e.jsx(ce,{children:n});export{me as default};
