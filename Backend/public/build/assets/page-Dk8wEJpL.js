import{r as n,j as e}from"./app-1-J-Rkvr.js";import{B as g,L as o,I as f}from"./label-BV62W-PP.js";import{C as ee,a as te}from"./card-BY_Q-Zm1.js";import{D as I,g as ae,a as F,b as T,c as L,e as se,U as ie}from"./Footer-D5nGiAW4.js";import{T as re}from"./textarea-Dah2xFhi.js";import{u as ne}from"./use-toast-BCIsxhQE.js";import{S as $,a as B,b as U,c as O,d as c}from"./select-D3TONI0m.js";import{P as le,S as oe,D as ce}from"./delete-confirmation-CNbCtFkH.js";import{I as de,E as me,T as he}from"./image-uploader-B8Gleyuh.js";import{D as ge}from"./database-error-D1QB9TqC.js";import{A as ue}from"./AdminLayout-nImAOwRT.js";import{C as xe}from"./clock-BOzEsbph.js";import"./index-B_wQ5iga.js";import"./circle-alert-CTpRWOly.js";const u="http://localhost:8000/api",pe=u.replace("/api",""),P=l=>l?l.startsWith("data:")||l.startsWith("http")?l:`${pe}${l}`:"/placeholder.svg";function fe(){const[l,A]=n.useState([]),[z,V]=n.useState([]),[q,_]=n.useState(!0),[w,C]=n.useState(null),[R,j]=n.useState(!1),[M,D]=n.useState(!1),[H,v]=n.useState(!1),[d,S]=n.useState(null),[i,J]=n.useState(null),[E,y]=n.useState(null),[a,x]=n.useState({title:"",description:"",location:"",urgency:"active",beneficiaries:"",linked_blog:"none",feature_image:"",start_date:"",end_date:""}),{toast:p}=ne(),b=async()=>{_(!0),C(null);try{const t=await fetch(`${u}/campaigns`);if(!t.ok)throw new Error("Failed to fetch campaigns");const s=await t.json();A(s)}catch(t){console.error("Error fetching campaigns:",t),C("Failed to fetch campaigns from database")}finally{_(!1)}},W=async()=>{try{const t=await fetch(`${u}/blog`);if(!t.ok)throw new Error("Failed to fetch blog posts");const s=await t.json();V(s)}catch(t){console.error("Error fetching blog posts:",t)}};n.useEffect(()=>{b(),W()},[]);const m=t=>{const{name:s,value:r}=t.target;x(h=>({...h,[s]:r}))},k=(t,s)=>{x(r=>({...r,[t]:s}))},K=t=>{x(s=>({...s,feature_image:t}))},G=async t=>{t.preventDefault();try{if(!a.title||!a.description){p({title:"Missing Required Fields",description:"Title and Description are required for a campaign.",variant:"destructive"});return}const s={title:a.title,description:a.description,location:a.location||null,urgency:a.urgency,beneficiaries:parseInt(a.beneficiaries)||0,linked_blog:a.linked_blog==="none"?null:parseInt(a.linked_blog),feature_image:a.feature_image||null,start_date:a.start_date||null,end_date:a.end_date||null};console.log("Saving campaign with data:",s);const r=localStorage.getItem("adminToken");if(!r)throw new Error("No authentication token found. Please log in again.");let h;if(d?h=await fetch(`${u}/campaigns/${d.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(s)}):h=await fetch(`${u}/campaigns`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(s)}),!h.ok){const Z=await h.json();throw new Error(Z.message||"Failed to save campaign")}p({title:d?"Campaign Updated":"Campaign Created",description:`"${a.title}" has been ${d?"updated":"created"} successfully.`}),N(),j(!1),b()}catch(s){console.error("Error saving campaign:",s),p({title:"Error",description:s.message||"Failed to save campaign",variant:"destructive"})}},N=()=>{x({title:"",description:"",location:"",urgency:"active",beneficiaries:"",linked_blog:"none",feature_image:"",start_date:"",end_date:""}),S(null)},Q=t=>{var s,r;S(t),x({title:t.title||"",description:t.description||"",location:t.location||"",urgency:t.urgency||"active",beneficiaries:((s=t.beneficiaries)==null?void 0:s.toString())||"",linked_blog:((r=t.linked_blog)==null?void 0:r.toString())||"none",feature_image:t.feature_image||"",start_date:t.start_date||"",end_date:t.end_date||""}),j(!0)},X=async()=>{if(E)try{const t=localStorage.getItem("adminToken");if(!t)throw new Error("No authentication token found. Please log in again.");const s=await fetch(`${u}/campaigns/${E}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!s.ok){const r=await s.json();throw new Error(r.message||"Failed to delete campaign")}p({title:"Campaign Deleted",description:"The campaign has been deleted successfully."}),b()}catch(t){console.error("Error deleting campaign:",t),p({title:"Error",description:t.message||"Failed to delete campaign",variant:"destructive"})}finally{v(!1),y(null)}},Y=t=>{switch(t){case"urgent":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-blue-100 text-blue-800"}};return q?e.jsxs("div",{className:"flex items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#e51083]"}),e.jsx("p",{className:"ml-4 text-gray-600 dark:text-gray-400",children:"Loading campaigns..."})]}):w?e.jsx(ge,{message:w}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Campaigns Management"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Create and manage campaigns"})]}),e.jsxs(I,{open:R,onOpenChange:j,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(g,{onClick:N,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"New Campaign"]})}),e.jsxs(F,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(L,{children:d?"Edit Campaign":"Create New Campaign"})}),e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"title",children:"Title *"}),e.jsx(f,{id:"title",name:"title",value:a.title,onChange:m,placeholder:"Enter campaign title",required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"location",children:"Location"}),e.jsx(f,{id:"location",name:"location",value:a.location,onChange:m,placeholder:"Campaign location"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"urgency",children:"Urgency"}),e.jsxs($,{value:a.urgency,onValueChange:t=>k("urgency",t),children:[e.jsx(B,{children:e.jsx(U,{placeholder:"Select urgency"})}),e.jsxs(O,{children:[e.jsx(c,{value:"urgent",children:"Urgent"}),e.jsx(c,{value:"high",children:"High"}),e.jsx(c,{value:"medium",children:"Medium"}),e.jsx(c,{value:"low",children:"Low"}),e.jsx(c,{value:"active",children:"Active"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"beneficiaries",children:"Beneficiaries"}),e.jsx(f,{id:"beneficiaries",name:"beneficiaries",type:"number",min:"0",value:a.beneficiaries,onChange:m,placeholder:"Number of beneficiaries"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"linked_blog",children:"Linked Blog Post"}),e.jsxs($,{value:a.linked_blog,onValueChange:t=>k("linked_blog",t),children:[e.jsx(B,{children:e.jsx(U,{placeholder:"Select blog post"})}),e.jsxs(O,{children:[e.jsx(c,{value:"none",children:"No Blog Post"}),z.map(t=>e.jsx(c,{value:t.id.toString(),children:t.title},t.id))]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"start_date",children:"Start Date"}),e.jsx(f,{id:"start_date",name:"start_date",type:"date",value:a.start_date,onChange:m})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"end_date",children:"End Date"}),e.jsx(f,{id:"end_date",name:"end_date",type:"date",value:a.end_date,onChange:m})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Featured Image"}),e.jsx(de,{currentImage:a.feature_image,onImageSelected:K,aspectRatio:"16:9"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"description",children:"Description *"}),e.jsx(re,{id:"description",name:"description",value:a.description,onChange:m,placeholder:"Campaign description",rows:5,required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>{N(),j(!1)},children:"Cancel"}),e.jsx(g,{type:"submit",children:d?"Update Campaign":"Create Campaign"})]})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(t=>e.jsxs(ee,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-video bg-gray-100 relative",children:t.feature_image?e.jsx("img",{src:P(t.feature_image),alt:t.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"No Image"})}),e.jsxs(te,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-2",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),t.location||"Location not specified"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),t.beneficiaries," beneficiaries"]}),(t.start_date||t.end_date)&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),t.start_date&&new Date(t.start_date).toLocaleDateString(),t.start_date&&t.end_date&&" - ",t.end_date&&new Date(t.end_date).toLocaleDateString()]})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Y(t.urgency)}`,children:t.urgency})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>{J(t),D(!0)},children:e.jsx(me,{className:"h-3 w-3"})}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Q(t),children:e.jsx(oe,{className:"h-3 w-3"})}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>{y(t.id),v(!0)},children:e.jsx(he,{className:"h-3 w-3"})})]})]})]},t.id))}),e.jsx(I,{open:M,onOpenChange:D,children:e.jsxs(F,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(T,{children:e.jsx(L,{children:i==null?void 0:i.title})}),i&&e.jsxs("div",{className:"space-y-4",children:[i.feature_image&&e.jsx("img",{src:P(i.feature_image),alt:i.title,className:"w-full rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Location"}),e.jsx("p",{className:"font-medium",children:i.location||"Not specified"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Urgency"}),e.jsx("p",{className:"font-medium capitalize",children:i.urgency})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Beneficiaries"}),e.jsx("p",{className:"font-medium",children:i.beneficiaries})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Duration"}),e.jsxs("p",{className:"font-medium",children:[i.start_date&&new Date(i.start_date).toLocaleDateString(),i.start_date&&i.end_date&&" - ",i.end_date&&new Date(i.end_date).toLocaleDateString()]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Description"}),e.jsx("p",{className:"whitespace-pre-wrap",children:i.description})]})]})]})}),e.jsx(ce,{isOpen:H,onClose:()=>{v(!1),y(null)},onConfirm:X,itemName:"campaign"})]})}fe.layout=l=>e.jsx(ue,{children:l});export{fe as default};
